<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ–º–æ –∫–∞—Ä—Ç—ã –°–î–≠–ö - –í—ã–±–æ—Ä –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏</title>
    <link rel="stylesheet" href="cdek-map-styles.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .demo-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .demo-header h1 {
            margin: 0 0 10px 0;
            font-size: 28px;
            font-weight: 600;
        }
        
        .demo-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 16px;
        }
        
        .demo-content {
            padding: 30px;
        }
        
        .demo-section {
            margin-bottom: 30px;
        }
        
        .demo-section h2 {
            color: #333;
            font-size: 20px;
            margin-bottom: 15px;
            border-bottom: 2px solid #007cba;
            padding-bottom: 8px;
        }
        
        .demo-info {
            background: #e3f2fd;
            border-left: 4px solid #007cba;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin-bottom: 20px;
        }
        
        .demo-info h3 {
            margin: 0 0 10px 0;
            color: #007cba;
            font-size: 16px;
        }
        
        .demo-info p {
            margin: 0;
            color: #666;
            line-height: 1.5;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
        }
        
        .feature-card h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }
        
        .feature-card p {
            margin: 0;
            color: #666;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .demo-controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e1e5e9;
        }
        
        .demo-controls h3 {
            margin: 0 0 15px 0;
            color: #333;
        }
        
        .control-group {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .control-group label {
            min-width: 120px;
            font-weight: 500;
            color: #555;
        }
        
        .control-group select,
        .control-group input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .control-group button {
            padding: 8px 16px;
            background: #007cba;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .control-group button:hover {
            background: #005a87;
        }
        
        @media (max-width: 768px) {
            .demo-header {
                padding: 20px;
            }
            
            .demo-header h1 {
                font-size: 24px;
            }
            
            .demo-content {
                padding: 20px;
            }
            
            .control-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .control-group label {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>üó∫Ô∏è –î–µ–º–æ –∫–∞—Ä—Ç—ã –°–î–≠–ö</h1>
            <p>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏ –∑–∞–∫–∞–∑–æ–≤</p>
        </div>
        
        <div class="demo-content">
            <div class="demo-info">
                <h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é!</h3>
                <p>–≠—Ç–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏ –°–î–≠–ö. –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥, –Ω–∞–π–¥–∏—Ç–µ —É–¥–æ–±–Ω—ã–π –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ –Ω–∞ –∫–∞—Ä—Ç–µ –∏–ª–∏ –≤ —Å–ø–∏—Å–∫–µ, –∏ –Ω–∞–∂–º–∏—Ç–µ "–í—ã–±—Ä–∞—Ç—å" –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.</p>
            </div>
            
            <div class="demo-section">
                <h2>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <h4>üó∫Ô∏è –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞</h4>
                        <p>–Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã —Å –ø—É–Ω–∫—Ç–∞–º–∏ –≤—ã–¥–∞—á–∏ –°–î–≠–ö, –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–∫</p>
                    </div>
                    <div class="feature-card">
                        <h4>üîç –ü–æ–∏—Å–∫ –ø–æ –≥–æ—Ä–æ–¥—É</h4>
                        <p>–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏ –≤ –ª—é–±–æ–º –≥–æ—Ä–æ–¥–µ –†–æ—Å—Å–∏–∏</p>
                    </div>
                    <div class="feature-card">
                        <h4>üì± –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω</h4>
                        <p>–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö</p>
                    </div>
                    <div class="feature-card">
                        <h4>‚ö° –ë—ã—Å—Ç—Ä–∞—è —Ä–∞–±–æ—Ç–∞</h4>
                        <p>–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã</p>
                    </div>
                </div>
            </div>
            
            <div class="demo-section">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ–º–æ</h2>
                <div class="demo-controls">
                    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—Ä—Ç—ã</h3>
                    <div class="control-group">
                        <label for="demo-city">–ì–æ—Ä–æ–¥:</label>
                        <select id="demo-city">
                            <option value="–ú–∞—Ö–∞—á–∫–∞–ª–∞">–ú–∞—Ö–∞—á–∫–∞–ª–∞</option>
                            <option value="–ú–æ—Å–∫–≤–∞">–ú–æ—Å–∫–≤–∞</option>
                            <option value="–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥">–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥</option>
                            <option value="–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥">–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥</option>
                            <option value="–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫">–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫</option>
                            <option value="–ö–∞–∑–∞–Ω—å">–ö–∞–∑–∞–Ω—å</option>
                        </select>
                        <button onclick="changeCity()">–ò–∑–º–µ–Ω–∏—Ç—å –≥–æ—Ä–æ–¥</button>
                    </div>
                    <div class="control-group">
                        <label for="demo-theme">–¢–µ–º–∞:</label>
                        <select id="demo-theme" onchange="changeTheme()">
                            <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
                            <option value="dark">–¢–µ–º–Ω–∞—è</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="demo-section">
                <h2>–ö–∞—Ä—Ç–∞ –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏</h2>
                
                <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∫–∞—Ä—Ç–∞ -->
                <div class="wp-block-cdek-checkout-map-block"></div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã -->
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU"></script>
    
    <!-- –≠–º—É–ª—è—Ü–∏—è WordPress –¥–∞–Ω–Ω—ã—Ö -->
    <script>
        // –≠–º—É–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö WordPress –¥–ª—è –¥–µ–º–æ
        window.cdekMapData = {
            apiUrl: '/demo-api/', // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ —ç—Ç–æ –±—É–¥–µ—Ç /wp-json/cdek/v1/
            nonce: 'demo-nonce',
            yandexApiKey: '',
            currentCity: '–ú–∞—Ö–∞—á–∫–∞–ª–∞'
        };
    </script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –∫–∞—Ä—Ç—ã -->
    <script>
        /**
         * –î–µ–º–æ –≤–µ—Ä—Å–∏—è –°–î–≠–ö –∫–∞—Ä—Ç—ã (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ WordPress)
         */
        class CDEKMapDemo {
            constructor() {
                this.map = null;
                this.clusterer = null;
                this.currentCity = '–ú–∞—Ö–∞—á–∫–∞–ª–∞';
                this.selectedOffice = null;
                this.offices = [];
                
                this.init();
            }

            async init() {
                // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç API
                await this.loadYandexMaps();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É
                this.initMap();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏ –°–î–≠–ö
                await this.loadCDEKOffices();
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
                this.bindEvents();
            }

            loadYandexMaps() {
                return new Promise((resolve) => {
                    if (window.ymaps) {
                        ymaps.ready(() => resolve());
                    } else {
                        // –ï—Å–ª–∏ API –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∂–¥–µ–º
                        setTimeout(() => {
                            ymaps.ready(() => resolve());
                        }, 1000);
                    }
                });
            }

            initMap() {
                const mapContainer = document.querySelector('.wp-block-cdek-checkout-map-block');
                
                if (!mapContainer) {
                    console.error('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return;
                }

                // –°–æ–∑–¥–∞–µ–º HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –∫–∞—Ä—Ç—ã
                mapContainer.innerHTML = `
                    <div class="cdek-map-container">
                        <div class="cdek-map-header">
                            <h3>–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ –Ω–∞ –∫–∞—Ä—Ç–µ</h3>
                            <div class="cdek-map-search">
                                <input type="text" id="cdek-city-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –≥–æ—Ä–æ–¥—É..." value="${this.currentCity}">
                                <button type="button" id="cdek-search-btn">–ù–∞–π—Ç–∏</button>
                            </div>
                        </div>
                        <div class="cdek-map-wrapper">
                            <div id="cdek-yandex-map" style="width: 100%; height: 450px;"></div>
                            <div class="cdek-offices-sidebar">
                                <div class="cdek-offices-list">
                                    <div class="cdek-loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏...</div>
                                </div>
                            </div>
                        </div>
                        <div class="cdek-selected-office" style="display: none;">
                            <h4>–í—ã–±—Ä–∞–Ω–Ω—ã–π –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏:</h4>
                            <div class="cdek-office-info"></div>
                        </div>
                    </div>
                `;

                // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                const initialCoords = this.getCityInitialCoords(this.currentCity);

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—É
                this.map = new ymaps.Map('cdek-yandex-map', {
                    center: initialCoords,
                    zoom: 12,
                    controls: ['zoomControl', 'fullscreenControl', 'geolocationControl']
                });

                // –°–æ–∑–¥–∞–µ–º –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ç–æ—Ä –¥–ª—è –º–µ—Ç–æ–∫
                this.clusterer = new ymaps.Clusterer({
                    preset: 'islands#invertedVioletClusterIcons',
                    groupByCoordinates: false,
                    clusterDisableClickZoom: false,
                    clusterHideIconOnBalloonOpen: false,
                    geoObjectHideIconOnBalloonOpen: false
                });

                this.map.geoObjects.add(this.clusterer);
            }

            getCityInitialCoords(cityName) {
                const cityCoords = {
                    '–ú–∞—Ö–∞—á–∫–∞–ª–∞': [42.9849, 47.5047],
                    '–ú–æ—Å–∫–≤–∞': [55.7558, 37.6176],
                    '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥': [59.9311, 30.3609],
                    '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': [56.8431, 60.6454],
                    '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫': [55.0084, 82.9357],
                    '–ö–∞–∑–∞–Ω—å': [55.8304, 49.0661]
                };

                return cityCoords[cityName] || cityCoords['–ú–æ—Å–∫–≤–∞'];
            }

            async loadCDEKOffices() {
                try {
                    await this.centerMapOnCity(this.currentCity);
                    const offices = this.getTestOffices();
                    this.offices = offices;
                    
                    this.displayOfficesOnMap(offices);
                    this.displayOfficesList(offices);
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏:', error);
                    this.showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏: ' + error.message);
                }
            }

            async centerMapOnCity(cityName) {
                try {
                    const coords = this.getCityInitialCoords(cityName);
                    this.map.setCenter(coords, 12);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
                }
            }

            getTestOffices() {
                const officesByCity = {
                    '–ú–∞—Ö–∞—á–∫–∞–ª–∞': [
                        {
                            code: 'MAH1',
                            name: '–°–î–≠–ö –Ω–∞ –õ–µ–Ω–∏–Ω–∞',
                            address: '—É–ª. –õ–µ–Ω–∏–Ω–∞, 45',
                            coordinates: [42.9849, 47.5047],
                            workTime: '–ü–Ω-–ü—Ç: 9:00-18:00, –°–±: 10:00-16:00',
                            phone: '+7 (8722) 123-456',
                            type: 'PVZ'
                        },
                        {
                            code: 'MAH2',
                            name: '–°–î–≠–ö –Ω–∞ –ì–∞–º–∏–¥–æ–≤–∞',
                            address: '–ø—Ä. –ì–∞–º–∏–¥–æ–≤–∞, 12',
                            coordinates: [42.9749, 47.5147],
                            workTime: '–ü–Ω-–í—Å: 10:00-20:00',
                            phone: '+7 (8722) 654-321',
                            type: 'PVZ'
                        },
                        {
                            code: 'MAH3',
                            name: '–°–î–≠–ö –≤ –¢–¶ –ö–∞—Å–ø–∏–π',
                            address: '—É–ª. –î–∞—Ö–∞–¥–∞–µ–≤–∞, 88, –¢–¶ –ö–∞—Å–ø–∏–π',
                            coordinates: [42.9949, 47.4947],
                            workTime: '–ü–Ω-–í—Å: 10:00-22:00',
                            phone: '+7 (8722) 789-012',
                            type: 'PVZ'
                        }
                    ],
                    '–ú–æ—Å–∫–≤–∞': [
                        {
                            code: 'MSK1',
                            name: '–°–î–≠–ö –Ω–∞ –¢–≤–µ—Ä—Å–∫–æ–π',
                            address: '—É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, 15',
                            coordinates: [55.7558, 37.6176],
                            workTime: '–ü–Ω-–ü—Ç: 8:00-20:00, –°–±-–í—Å: 10:00-18:00',
                            phone: '+7 (495) 123-456',
                            type: 'PVZ'
                        },
                        {
                            code: 'MSK2',
                            name: '–°–î–≠–ö –Ω–∞ –ê—Ä–±–∞—Ç–µ',
                            address: '—É–ª. –ê—Ä–±–∞—Ç, 25',
                            coordinates: [55.7520, 37.5985],
                            workTime: '–ü–Ω-–í—Å: 9:00-21:00',
                            phone: '+7 (495) 654-321',
                            type: 'PVZ'
                        }
                    ]
                };

                return officesByCity[this.currentCity] || officesByCity['–ú–∞—Ö–∞—á–∫–∞–ª–∞'];
            }

            displayOfficesOnMap(offices) {
                this.clusterer.removeAll();

                if (offices.length === 0) {
                    return;
                }

                const placemarks = offices.map(office => {
                    const placemark = new ymaps.Placemark(
                        office.coordinates,
                        {
                            balloonContentHeader: office.name,
                            balloonContentBody: `
                                <div class="cdek-balloon">
                                    <p><strong>–ê–¥—Ä–µ—Å:</strong> ${office.address}</p>
                                    <p><strong>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:</strong> ${office.workTime}</p>
                                    <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${office.phone}</p>
                                    <button class="cdek-select-office-btn" data-office-code="${office.code}">
                                        –í—ã–±—Ä–∞—Ç—å —ç—Ç–æ—Ç –ø—É–Ω–∫—Ç
                                    </button>
                                </div>
                            `,
                            balloonContentFooter: `–ö–æ–¥: ${office.code}`
                        },
                        {
                            preset: 'islands#violetDotIconWithCaption',
                            iconCaptionMaxWidth: '200'
                        }
                    );

                    placemark.events.add('click', () => {
                        this.selectOffice(office);
                    });

                    return placemark;
                });

                this.clusterer.add(placemarks);
            }

            displayOfficesList(offices) {
                const listContainer = document.querySelector('.cdek-offices-list');
                
                if (offices.length === 0) {
                    listContainer.innerHTML = '<div class="cdek-no-offices">–ü—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –¥–∞–Ω–Ω–æ–º –≥–æ—Ä–æ–¥–µ</div>';
                    return;
                }

                const officesHTML = offices.map(office => `
                    <div class="cdek-office-item" data-office-code="${office.code}">
                        <div class="cdek-office-name">${office.name}</div>
                        <div class="cdek-office-address">${office.address}</div>
                        <div class="cdek-office-time">${office.workTime}</div>
                        <div class="cdek-office-phone">${office.phone}</div>
                        <button class="cdek-select-office-btn" data-office-code="${office.code}">
                            –í—ã–±—Ä–∞—Ç—å
                        </button>
                    </div>
                `).join('');

                listContainer.innerHTML = officesHTML;
            }

            selectOffice(office) {
                this.selectedOffice = office;
                
                const selectedContainer = document.querySelector('.cdek-selected-office');
                const infoContainer = document.querySelector('.cdek-office-info');
                
                infoContainer.innerHTML = `
                    <div class="cdek-selected-info">
                        <strong>${office.name}</strong><br>
                        ${office.address}<br>
                        ${office.workTime}<br>
                        ${office.phone}
                    </div>
                `;
                
                selectedContainer.style.display = 'block';

                document.querySelectorAll('.cdek-office-item').forEach(item => {
                    item.classList.remove('selected');
                });
                
                const selectedItem = document.querySelector(`[data-office-code="${office.code}"]`);
                if (selectedItem) {
                    selectedItem.classList.add('selected');
                }

                this.map.setCenter(office.coordinates, 15);
                this.showNotification(`–í—ã–±—Ä–∞–Ω –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏: ${office.name}`);
            }

            bindEvents() {
                const searchBtn = document.getElementById('cdek-search-btn');
                const cityInput = document.getElementById('cdek-city-search');

                if (searchBtn && cityInput) {
                    searchBtn.addEventListener('click', () => {
                        this.searchCity(cityInput.value);
                    });

                    cityInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            this.searchCity(cityInput.value);
                        }
                    });
                }

                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('cdek-select-office-btn')) {
                        e.preventDefault();
                        const officeCode = e.target.getAttribute('data-office-code');
                        const office = this.offices.find(o => o.code === officeCode);
                        if (office) {
                            this.selectOffice(office);
                        }
                    }
                });
            }

            async searchCity(cityName) {
                if (!cityName.trim()) return;

                this.currentCity = cityName;
                document.querySelector('.cdek-offices-list').innerHTML = '<div class="cdek-loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏...</div>';
                
                this.selectedOffice = null;
                document.querySelector('.cdek-selected-office').style.display = 'none';
                
                await this.loadCDEKOffices();
            }

            showError(message) {
                const listContainer = document.querySelector('.cdek-offices-list');
                listContainer.innerHTML = `
                    <div class="cdek-error">
                        ${message}
                        <br><br>
                        <button type="button" onclick="location.reload()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                    </div>
                `;
            }

            showNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'cdek-notification';
                notification.textContent = message;
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #4caf50;
                    color: white;
                    padding: 12px 20px;
                    border-radius: 4px;
                    z-index: 10000;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                `;

                document.body.appendChild(notification);

                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 3000);
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–µ–º–æ –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤
        function changeCity() {
            const citySelect = document.getElementById('demo-city');
            const selectedCity = citySelect.value;
            
            if (window.cdekMapDemo) {
                window.cdekMapDemo.searchCity(selectedCity);
            }
        }

        function changeTheme() {
            const themeSelect = document.getElementById('demo-theme');
            const selectedTheme = themeSelect.value;
            
            if (selectedTheme === 'dark') {
                document.body.style.background = '#1a1a1a';
                document.querySelector('.demo-container').style.background = '#2d2d2d';
                document.querySelector('.demo-container').style.color = '#ffffff';
            } else {
                document.body.style.background = '#f5f5f5';
                document.querySelector('.demo-container').style.background = 'white';
                document.querySelector('.demo-container').style.color = '#333333';
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–µ–º–æ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', () => {
            window.cdekMapDemo = new CDEKMapDemo();
        });
    </script>
</body>
</html>