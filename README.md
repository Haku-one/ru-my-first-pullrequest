# 🗺️ СДЭК плагин с интерактивной картой для WooCommerce

Этот репозиторий содержит обновленный плагин СДЭК для WooCommerce с **интерактивной картой** пунктов выдачи.

## 📦 Готовые файлы

### 🎯 Главные файлы:
- **`cdek-shipping-with-map-fixed.zip`** - ✅ **ИСПРАВЛЕННЫЙ** готовый плагин с картой
- **`cdek-shipping-with-map.zip`** - предыдущая версия
- **`test-map.html`** - 🧪 **ТЕСТОВАЯ СТРАНИЦА** для проверки карты

### 📂 Исходники:
- **`cdek-shipping/`** - папка с исходным кодом плагина
- **`UPDATE_GUIDE.md`** - подробное руководство по обновлению

### 🛠️ Дополнительные файлы (для разработки):
- **`cdek-api-handler.php`** - отдельный API обработчик
- **`cdek-map-integration.js`** - основной JavaScript для карты
- **`cdek-map-styles.css`** - стили для карты
- **`demo.html`** - демонстрационная страница

## ✨ Возможности

- **🗺️ Интерактивная карта** с Яндекс.Картами
- **🔄 Переключение** между списком и картой
- **🔍 Поиск по городу** с автозаполнением
- **📍 Клик по точкам** на карте для выбора
- **🎯 Автоцентрирование** карты на выбранной точке
- **📱 Адаптивный дизайн** для мобильных устройств
- **🔔 Уведомления** о выборе пункта
- **⚡ Кэширование** данных для быстрой работы
- **🧪 Тестовые данные** для демонстрации

## 🧪 Быстрый тест

**Хотите сразу увидеть как работает карта?**

1. **Скачайте** файл `test-map.html`
2. **Откройте** его в браузере
3. **Увидите** полностью рабочую карту с пунктами выдачи!

Или просто откройте: [test-map.html](test-map.html)

### Что покажет тест:
- ✅ Список пунктов выдачи
- ✅ Интерактивная карта
- ✅ Переключение между видами
- ✅ Поиск по городам (Москва, СПб, Екатеринбург)
- ✅ Клик по точкам на карте
- ✅ Выбор пунктов

## 🚀 Быстрая установка

1. **Скачайте** файл `cdek-shipping-with-map-fixed.zip` ⬅️ **ЭТОТ!**
2. **Зайдите** в админку WordPress → Плагины → Добавить новый
3. **Загрузите** ZIP файл
4. **Активируйте** плагин
5. **Настройте** API ключи СДЭК в настройках

## ⚙️ Настройка

### Обязательные настройки:
1. **СДЭК API** - получите в [личном кабинете СДЭК](https://www.cdek.ru/ru/integration)
2. **Client ID** и **Client Secret** - введите в настройках плагина

### Рекомендуемые настройки:
1. **Яндекс.Карты API** - получите на [Developer Яндекс](https://developer.tech.yandex.ru/)
2. **API ключ** - введите для улучшенной работы карты

## 🎮 Как работает

1. Покупатель выбирает доставку СДЭК на checkout
2. Появляется блок с выбором пункта выдачи
3. Можно переключаться между списком и картой
4. На карте видны все пункты выдачи в городе
5. Клик по точке показывает детали и позволяет выбрать пункт
6. Выбранный пункт автоматически применяется к заказу

## 🔧 Технические детали

### Требования:
- WordPress 5.0+
- WooCommerce 4.0+
- PHP 7.4+

### Совместимость:
- ✅ WooCommerce Blocks (новый checkout)
- ✅ Классический WooCommerce checkout
- ✅ Все современные браузеры
- ✅ Мобильные устройства

### API интеграции:
- **СДЭК API v2** - для получения пунктов выдачи
- **Яндекс.Карты API** - для отображения карты
- **WordPress REST API** - для обмена данными

## 📱 Скриншоты

### Список пунктов выдачи:
```
┌─────────────────────────────────────┐
│ 🗺️ Выберите пункт выдачи CDEK      │
│ ┌─────────────────┬─────────────────┐ │
│ │ Москва          │ [🔍 Найти]     │ │
│ └─────────────────┴─────────────────┘ │
│ ┌─────────┬─────────┐                 │
│ │📋Список │🗺️Карта │                 │
│ └─────────┴─────────┘                 │
│ ┌─────────────────────────────────────┐ │
│ │ 📍 СДЭК Центральный            ✅  │ │
│ │ 🏠 ул. Центральная, 1              │ │
│ │ 🕒 Пн-Пт: 9:00-18:00               │ │
│ │ 📞 +7 (495) 123-45-67              │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### Режим карты:
```
┌─────────────────────────────────────┐
│ 🗺️ Выберите пункт выдачи CDEK      │
│ ┌─────────────────┬─────────────────┐ │
│ │ Москва          │ [🔍 Найти]     │ │
│ └─────────────────┴─────────────────┘ │
│ ┌─────────┬─────────┐                 │
│ │📋Список │🗺️Карта │                 │
│ └─────────┴─────────┘                 │
│ ┌─────────────────────────────────────┐ │
│ │    🗺️ Интерактивная карта СДЭК    │ │
│ │                                     │ │
│ │     📍      📍       📍            │ │
│ │                                     │ │
│ │  📍    🎯📍     📍                 │ │
│ │                                     │ │
│ │     📍       📍      📍            │ │
│ └─────────────────────────────────────┘ │
│ ✅ Выбран: СДЭК Центральный            │
│ 🏠 ул. Центральная, 1                  │
│ 🕒 Пн-Пт: 9:00-18:00                  │
│ 📞 +7 (495) 123-45-67                 │
└─────────────────────────────────────┘
```

## 🔍 Отладка и тестирование

### Консоль браузера:
Откройте F12 → Console, чтобы увидеть логи:
```
CDEK Map: Initializing...
CDEK Map: Loading Yandex Maps API...
CDEK Map: Yandex Maps script loaded
CDEK Map: Map created successfully
CDEK Map: Displaying points on map: 3
```

### Тестовые города:
- **Москва** - 3 пункта выдачи
- **Санкт-Петербург** - 3 пункта выдачи  
- **Екатеринбург** - 3 пункта выдачи
- **Новосибирск** - 3 пункта выдачи
- **Махачкала** - 3 пункта выдачи

### Если карта не показывается:
1. **Проверьте консоль** браузера (F12)
2. **Убедитесь** что выбран способ доставки СДЭК
3. **Попробуйте** тестовую страницу `test-map.html`
4. **Проверьте** что JavaScript не заблокирован

## 🆘 Поддержка

При возникновении проблем:

1. **Проверьте** настройки API ключей
2. **Включите** режим отладки WordPress
3. **Проверьте** консоль браузера (F12)
4. **Протестируйте** на `test-map.html`
5. **Прочитайте** `UPDATE_GUIDE.md` для решения типичных проблем

## 🔄 История версий

- **v1.2** - Исправления отображения карты, улучшенная отладка
- **v1.1** - Добавлена интерактивная карта с Яндекс.Картами
- **v1.0** - Базовый плагин СДЭК с списком пунктов выдачи

## 📝 Лицензия

GPL v2 or later - совместимо с WordPress и WooCommerce

---

**Создано для улучшения пользовательского опыта в интернет-магазинах с доставкой СДЭК** 🚀

**🧪 Не забудьте протестировать на `test-map.html` перед установкой!**