# CDEK Shipping для WooCommerce - Инструкция по установке

## Описание

Плагин интегрирует доставку CDEK с WooCommerce, автоматически скрывает ненужные поля формы адреса (населённый пункт, область, почтовый индекс) и определяет город из поля "Адрес" для поиска пунктов выдачи CDEK.

## Требования

- WordPress 5.0+
- WooCommerce 5.0+
- PHP 7.4+
- Действующий аккаунт CDEK с API доступом

## Установка

### 1. Загрузка плагина

Скопируйте папку `cdek-shipping` в директорию `/wp-content/plugins/` вашего WordPress сайта.

### 2. Активация

1. Войдите в админку WordPress
2. Перейдите в **Плагины** → **Установленные**
3. Найдите "CDEK Shipping for WooCommerce" и нажмите **Активировать**

### 3. Настройка API

1. Перейдите в **Настройки** → **CDEK Shipping**
2. Введите данные API CDEK:
   - **Account ID**: `Lr7x5fauu0eOXDA4hlK04HiMUpqHgzzR`
   - **Password**: `fzwKqoaKaTrwRjxVhf6csNzTefyHRHYM`
   - **Yandex Maps API Key**: `4020b4d5-1d96-476c-a10e-8ab18f0f3702`
3. Нажмите **Сохранить настройки**
4. Проверьте соединение кнопкой **Проверить соединение с CDEK API**

### 4. Настройка зон доставки

1. Перейдите в **WooCommerce** → **Настройки** → **Доставка**
2. Создайте зону доставки для России:
   - Нажмите **Добавить зону доставки**
   - Название: "Россия"
   - Регионы: Добавьте "Russia"
3. В созданной зоне нажмите **Добавить способ доставки**
4. Выберите **CDEK Shipping** из списка
5. Настройте параметры:
   - **Включить**: ✓
   - **Название метода**: "Доставка CDEK"
   - **Город отправки**: укажите ваш город (например, "Москва")
   - **Пункты выдачи**: ✓ (если нужно)
   - **Курьерская доставка**: ✓ (если нужно)
   - **Наценка (%)**: при необходимости
   - **Сумма для бесплатной доставки**: при необходимости

## Настройка товаров

Для корректного расчета доставки укажите у товаров:

1. **Вес (г)** - обязательно
2. **Размеры (см)** - длина, ширина, высота (рекомендуется)

Перейдите в товар → вкладка **Доставка** и заполните параметры.

## Проверка работы

### 1. Тест формы адреса

1. Перейдите на страницу оформления заказа
2. Убедитесь, что поля "Населённый пункт", "Область/район", "Почтовый индекс" скрыты
3. В поле "Адрес" введите: `Москва, ул. Тверская д.1`

### 2. Тест выбора доставки

1. Выберите способ доставки "CDEK Shipping"
2. Должны появиться варианты тарифов с ценами
3. При выборе тарифа с пунктами выдачи должен появиться список точек

### 3. Тест создания заказа

1. Оформите тестовый заказ
2. В админке перейдите к заказу
3. В боковой панели должен быть блок "CDEK Доставка" с информацией
4. При переводе заказа в статус "В обработке" автоматически создастся заказ в CDEK

## Устранение неполадок

### Не работает API

1. Проверьте правильность Account ID и Password
2. Убедитесь, что ваш IP не заблокирован CDEK
3. Проверьте лог ошибок WordPress

### Не показываются пункты выдачи

1. Убедитесь, что город правильно извлекается из адреса
2. Проверьте, есть ли пункты выдачи CDEK в указанном городе
3. Проверьте консоль браузера на ошибки JavaScript

### Поля не скрываются

1. Очистите кеш плагинов и браузера
2. Проверьте конфликты с другими плагинами
3. Убедитесь, что CSS файлы загружаются

## Дополнительные настройки

### Отправитель

Добавьте в `wp-config.php` или через настройки:

```php
// Данные отправителя для CDEK
add_option('cdek_sender_name', 'Ваша компания');
add_option('cdek_sender_phone', '+7-123-456-78-90');
add_option('cdek_from_city', 'Ваш город');
```

### Кастомизация

Вы можете переопределить стили в своей теме:

```css
/* Дополнительные стили для CDEK */
.cdek-pickup-points {
    /* ваши стили */
}
```

## Поддержка

При возникновении проблем:

1. Проверьте логи WordPress
2. Включите режим отладки WP_DEBUG
3. Проверьте вкладку Network в браузере при AJAX запросах

## Безопасность

- Все AJAX запросы защищены nonce
- Входные данные санитизируются
- Доступ к функциям проверяется по правам пользователя

## Обновления

При обновлении плагина:

1. Сделайте резервную копию сайта
2. Проверьте совместимость с вашей версией WooCommerce
3. Протестируйте на staging среде

---

Плагин готов к использованию! Все основные функции работают через API CDEK и автоматически интегрируются с WooCommerce.